# 0. Swap caps lock and ctrl
loadkeys /usr/share/kbd/keymaps/i386/qwerty/emacs2.map.gz
kbdrate -d 30  -r 400

# 1. Partitioning

lsblk
fdisk -l

mkfs.ext3 /dev/sda1
mkfs.ext4 /dev/sda5
mkfs.ext4 /dev/sda6
mkfs.ext4 /dev/sda8

/dev/sda5        46G   12G   32G  27% /
/dev/sda1       227M   36M  179M  17% /boot
/dev/sda6        30G  4.0G   24G  15% /var
/dev/sda8       610G  123G  457G  22% /home

# 2. Mounting

mount /dev/sda5 /mnt
mkdir /mnt/boot /mnt/var /mnt/home

mount /dev/sda1 /mnt/boot
mount /dev/sda6 /mnt/var
mount /dev/sda8 /mnt/home

# 3. install system base
pacstrap /mnt base vim tmux

# 4. generate fstab
genfstab -p /mnt >> /mnt/etc/fstab

# 5. change root new env
arch-chroot /mnt
# 5.1 clang + vim
pacman -S clang && vim && cd ~/.vim/bundle/YouCompleteMe && ./install.sh --clang-completer --system-libclang

# get stop sweet home
cd /opt && git clone https://github.com/jkoz/home tait

# 6. create hostname
echo "jkoz_arch_linux" > /etc/hostname

# 7. locale setting
ln -s /usr/share/zoneinfo/Canada/Mountain /etc/localtime

# 8. enable us locale

sed -i 's!#en_US.UTF-8 UTF-8!en_US.UTF-8 UTF-8!' /etc/locale.gen
sed -i 's!#en_US ISO-8859-1!en_US ISO-8859-1!' /etc/locale.gen

locale-gen

# important in order to support unicode charaters in urxvt; give it a test echo "\udf"
localectl set-locale LANG=en_US.UTF-8

# 9. increase kdb rate and persistent keymap (swap caplocks and ctrl)

echo "KEYMAP=\"emacs2\"" > /etc/vconsole.conf
kbdrate -d 30  -r 400

# 10. install grub
pacman -S grub

mkinitcpio -p linux
grub-install /dev/sda
grub-mkconfig -o /boot/grub/grub.cfg

# 11. reboot and set up root passwd
passwd

# 12. enable service network
systemctl list-unit-files

# to temporarily use wire connection start dhcpcd client
systemctl start dhcpcd # a workaround method to enable wire connection. In fact, we should use netctl

# 13. add new user
useradd -m -g users -G audio,lp,optical,storage,video,wheel,games,power -d/home/tait -s /usr/bin/zsh tait
usermod -s /usr/bin/zsh root

# 14. enable for wheel groups
pacman -S sudo
sudoedit /etc/sudoers
uncomment %wheel ALL=(ALL) ALL

# 14.0 persistent network wireless and wire profiles
pacman -S wifi-menu net-tools rfkill wireless_tools

pacman -S wpa_actiond ifplugd

#wifi-menu wlp2s0
systemctl enable netctl-auto@wlp2s0

#cp /etc/netctl/examples/ethernet-dhcp /etc/netctl/enp3s0-tp & replace the ethenert name
systemctl enable netctl-ifplugd@enp3s0

# 14.1
# ctags bc dialog wpa_supplicant wpa_actiond elinks zsh fish fbterm git hg subversion \
              cvs xclip axel zip unzip unrar rtorrent alsa-utils alsa-oss samba openssh cdrkit \
              cabextract cmake mutt ntfs-3g fetchmail procmail bitlbee irssi mpd mpc ncmpcpp gdb \
              perl-cpanplus-dist-arch python-pip

# 14.1.0 battery info
pacman -S acpid

# 14.1.1 ntpd
pacman -S ntp
systemctl start ntpd


# 14.2 yaourt
pacman -S base-devel
curl -O https://aur.archlinux.org/packages/pa/package-query/package-query.tar.gz && tar xzvf package-query.tar.gz && cd package-query && makepkg -si --asroot
curl -O https://aur.archlinux.org/packages/ya/yaourt/yaourt.tar.gz && tar xzvf yaourt.tar.gz && cd yaourt && makepkg -si --asroot
rm -rf package-query.tar.gz yaourt.tar.gz

# 14.2.1 clouds
yaourt -S dropbox-cli grive

# 14.2.2 Ack Grep Ag
yaourt -S silver-searcher-git

# 14.3 x & wm
pacman -S xdotool xorg xorg-server xorg-xinit xlockmore rxvt-unicode xautolock x11vnc
pacman -S libxcb xcb-util xcb-util-keysyms xcb-util-wm bspwm-git
yaourt -S sxhkd-git xtitle-git bar-aint-recursive

# 14.3.1 desktop notification
pacman -S libnotify dunst

# 14.3.2 fonts
pacman -S pcf2bdf
yaourt -S gbdfed

# 14.3 media
pacman -S mplayer

# 14.4 pdf
mupdf
cabaret

# 14.5 photos
feh
imagemagick
gimp
ncitrogen

# 14.6 screenshoot
scrot
# 14.7 mount camera, android, etc.
yaourt -S simple-mtpfs

# 14.8 composite
yaourt -S compton

# 14.8 file manager
pacman -S pcmanfm ranger

# 14.9 browsers
pacman -S chromium chromium-pepper-flash
pacman -S dwb

# 15 extras
# cpan
cpan Net:DBus
# status
yaourt -S archey

# 16 mines
git clone https://github.com/jkoz/dmenu2 jkoz/dmenu2
git clone https://github.com/jkoz/ldoce5viewer


# start ntp
############################################

# network
 wifi-menu

#####################################################################
# IF WE USE netctl-auto@wlan0 service, please don't touch wpa_supplicant low
# level configuration
#####################################################################

# netctl manually enable network profile
netctl enable wlp2s0-tp

# use wpa_supplicant
# create /etc/wpa_supplicant/wpa_supplicant-wlp0s29u1u2.conf
#ctrl_interface=/run/wpa_supplicant
#ctrl_interface_group=wheel
#ap_scan=1
#update_config=1

#network={
    #ssid="tp"
    #scan_ssid=1
    #psk="mykey"
#}
# start
systemctl start wpa_supplicant@wlp0s29u1u2
# stop wpa
systemctl stop wpa_supplicant@wlp0s29u1u2
wpa_cli terminate


yaourt -S shrew-vpn-client

# xdg
pacman -S xdg-user-dirs
xdg-user-dirs-update

# dict
yaourt -S stardict-tools
yaourt -S dictconv
yaourt -Ss golden
yaourt -Ss stardict
yaourt -S makedict

# extra
 pacman -S lm_sensors
 pacman -S libxft
 pacman -S freetype2

# for install olad8
pacman -S lib32-gtk
pacman -S lib32-alsa-lib
pacman -S lib32-nvidia-utils
pacman -S lib32-libdbus

#######################################
readcd -v dev=/dev/cdrom -f abc.iso

#systemd
systemctl daemon-reload  # scanning for new & changes
systemctl restart systemd-logind  # disable auto suspended on laptop; add HandleLidSwitch=ignore in /etc/systemd/logind.conf
systemctl --user list-unit-files # list user units
systemctl --user enable mpd # enable users units

pacman -Q # list all installed packages
pacman -Qi # list all installed packages with more info
pacman -Q -n # list all installed packages founded in sync db
pacman -Q -m # list all installed packages founded elsewhere, aur
pacman -Q -g base base-devel # list all installed package belongs to group base or base devel


expac -HM "%011m\t%-20n\t%10d" $(comm -23 <(pacman -Qqen | sort) <(pacman -Qqg base base-devel | sort) ) | sort -n # list all installed package that no base or base-devel

#bspc
