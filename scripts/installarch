########################################################
# 0. Swap caps lock and ctrl
# loadkeys /usr/share/kbd/keymaps/i386/qwerty/emacs2.map.gz || exit 1
# kbdrate -d 30  -r 400 || exit 1

# lsblk
# fdisk -l

# mkfs.ext3 /dev/sda1
# mkfs.ext4 /dev/sda5
# mkfs.ext4 /dev/sda6
# mkfs.ext4 /dev/sda8

# /dev/sda5        46G   12G   32G  27% /
# /dev/sda1       227M   36M  179M  17% /boot
# /dev/sda6        30G  4.0G   24G  15% /var
# /dev/sda8       610G  123G  457G  22% /home

# mount /dev/sda5 /mnt
# mkdir /mnt/{boot,var,home}

# mount /dev/sda1 /mnt/boot
# mount /dev/sda6 /mnt/var
# mount /dev/sda8 /mnt/home

# 3. install system base
# pacstrap /mnt base openssh vim tmux sudo git zsh grub elinks net-tools wireless_tools wpa_actiond ifplugd rfkill axel alsa-utils || exit 1

# 4. generate fstab
# genfstab -p /mnt >> /mnt/etc/fstab || exit 1

# 5. change root new env
#arch-chroot /mnt || { echo fail chroot; exit 1; }

#########################################################
# 5.1 clang + vim
# pacman -S clang && vim && cd ~/.vim/bundle/YouCompleteMe && ./install.sh --clang-completer --system-libclang

git clone https://github.com/jkoz/home github/jkoz /opt/github/jkoz/home || { echo fail to get dotfiles; exit 1; }

# 6. create hostname
echo "archlinux" > /etc/hostname || { echo fail to create host name; exit 1; }

# 7. locale setting
ln -s /usr/share/zoneinfo/Canada/Mountain /etc/localtime || { echo fail to set local time; exit 1; }

# 8. enable us locale
sed -i 's!#en_US.UTF-8 UTF-8!en_US.UTF-8 UTF-8!' /etc/locale.gen || { echo fail to enable en_US.UTF-8 UTF-8; exit 1; }
sed -i 's!#en_US ISO-8859-1!en_US ISO-8859-1!' /etc/locale.gen || { echo fail to enable en_US ISO-8859-1; exit 1; }
locale-gen || { echo fail to generate locale; exit 1; }

# FIXME: error before x installation
# important in order to support unicode charaters in urxvt; give it a test echo "\udf"
localectl set-locale LANG=en_US.UTF-8 || { echo fail to set locale; exit 1; }

# 9. increase kdb rate and persistent keymap (swap caplocks and ctrl)

echo "KEYMAP=\"emacs2\"" > /etc/vconsole.conf || { echo fail to set keymap; exit 1; }
kbdrate -d 30  -r 400 || { echo fail to speed up typing; exit 1; }

# 10. install grub
mkinitcpio -p linux || { echo fail to init tcpio ; exit 1; }
grub-install /dev/sda || { echo fail to install grub; exit 1; }
grub-mkconfig -o /boot/grub/grub.cfg || { echo fail to create grub config; exit 1; }

# 11. reboot and set up root passwd
echo "Type root passwd"
passwd

# 12. enable service network: copy from bootable disk: cp /etct/netctl/wlp0s29u1u2-tp /mnt/etct/netctl/wlp0s29u1u2-tp
systemctl enable netctl-auto@wlp0s29u1u2 || { exit 1; }
systemctl enable netctl-ifplugd@enp3s0 || { exit 1; }

# 13. add new user
useradd -m -g users -G audio,lp,optical,storage,video,wheel,games,power -d/home/tait -s /usr/bin/zsh tait || { exit 1; }
usermod -s /usr/bin/zsh root || { exit 1; }

# 14. enable for wheel groups, uncomment %wheel ALL=(ALL) ALL
sudoedit /etc/sudoers || { exit 1; }


# 14.1
#pacman -S ctags bc fish fbterm hg subversion cvs xclip axel zip unzip unrar rtorrent alsa-utils samba
#pacman -S cdrkit growisofs
#pacman -S cabextract cmake mutt ntfs-3g fetchmail procmail bitlbee irssi mpd mpc ncmpcpp gdb
#pacman -S perl-cpanplus-dist-arch python-pip

#pacman -S acpid # battery info

# 14.1.1 ntpd
pacman -S ntp && systemctl enable ntpd || { exit 1; }

# 14.2 yaourt
pacman -S base-devel || { exit 1; }
cd /tmp || { exit 1; }
curl -O https://aur.archlinux.org/packages/pa/package-query/package-query.tar.gz && tar xzvf package-query.tar.gz && cd package-query && makepkg -si --asroot || { exit 1; }
curl -O https://aur.archlinux.org/packages/ya/yaourt/yaourt.tar.gz && tar xzvf yaourt.tar.gz && cd yaourt && makepkg -si --asroot || { exit 1; }

# ack
yaourt -S silver-searcher-git

# 14.3 x & wm
pacman -S  --noconfirm xorg xorg-server xorg-xinit xlockmore rxvt-unicode xautolock x11vnc
pacman -S  --noconfirm libxcb xcb-util xcb-util-keysyms xcb-util-wm \
yaourt -S sxhkd-git xtitle-git bar-aint-recursive bspwm-git xdo-git
pacman -S  --noconfirm xdg-user-dirs
pacman -S  --noconfirm chromium
pacman -S  --noconfirm libnotify dunst
pacman -S  --noconfirm mplayer
pacman -S  --noconfirm mupdf
pacman -S  --noconfirm feh
pacman -S  --noconfirm imagemagick
pacman -S  --noconfirm gimp
pacman -S  --noconfirm scrot
pacman -S --noconfirm xorg-xlsfonts
pacman -S --noconfirm tk # for gitk

yaourt -S chromium-pepper-flash
yaourt -S dropbox-cli
yaourt -S archey # status

yaourt -S ttf-ms-fonts # status
yaourt -S adobe-source-code-pro-fonts

pacman -S  --noconfirm ranger
yaourt -S gbdfed pcf2bdf # fonts
yaourt -S cabaret # pdf
yaourt -S grive

# 16 mines
cd ~ && pkg=/opt/github/jkoz/PKGBUILDs && rm -rf $pkg && git clone https://github.com/jkoz/PKGBUILDs $pkg && cd $pkg && for dir in `ls $pkg`; do cd $dir; ls | grep -v PKGBUID | xargs ;  makepkg -si --asroot; cd .. ; done

yaourt -S dropbox-cli grive
yaourt -S simple-mtpfs # mount camera, android, etc.
yaourt -S compton # 14.8 composite


cpan Net:DBus # cpan


#####################################################################
# IF WE USE netctl-auto@wlan0 service, please don't touch wpa_supplicant low
# level configuration
#####################################################################

# netctl manually enable network profile
netctl enable wlp2s0-tp

# use wpa_supplicant
# create /etc/wpa_supplicant/wpa_supplicant-wlp0s29u1u2.conf
#ctrl_interface=/run/wpa_supplicant
#ctrl_interface_group=wheel
#ap_scan=1
#update_config=1

#network={
    #ssid="tp"
    #scan_ssid=1
    #psk="mykey"
#}
# start
systemctl start wpa_supplicant@wlp0s29u1u2
# stop wpa
systemctl stop wpa_supplicant@wlp0s29u1u2
wpa_cli terminate


yaourt -S shrew-vpn-client

# xdg
xdg-user-dirs-update

# dict
yaourt -S stardict-tools
yaourt -S dictconv
yaourt -Ss golden
yaourt -Ss stardict
yaourt -S makedict

# extra
 pacman -S lm_sensors

# xft
pacman -S libxft
pacman -S freetype2

# for install olad8
pacman -S lib32-gtk
pacman -S lib32-alsa-lib
pacman -S lib32-nvidia-utils
pacman -S lib32-libdbus

#######################################
readcd -v dev=/dev/cdrom -f abc.iso

#systemd
systemctl daemon-reload  # scanning for new & changes
systemctl restart systemd-logind  # disable auto suspended on laptop; add HandleLidSwitch=ignore in /etc/systemd/logind.conf
systemctl --user list-unit-files # list user units
systemctl --user enable mpd # enable users units

pacman -Q # list all installed packages
pacman -Qi # list all installed packages with more info
pacman -Q -n # list all installed packages founded in sync db
pacman -Q -m # list all installed packages founded elsewhere, aur
pacman -Q -g base base-devel # list all installed package belongs to group base or base devel
pacman -Ql # list where files are stored


expac -HM "%011m\t%-20n\t%10d" $(comm -23 <(pacman -Qqen | sort) <(pacman -Qqg base base-devel | sort) ) | sort -n # list all installed package that no base or base-devel

# handle image & partition
yaourt -S multipath-tools-git

#bspc
#
# INSTALL ARCH ON NEXUS
# as root
pacman -S android-tools
pacman -S android-udev

# archieve
zip -R file.txt folder1/ folder2/

# unblock bootloader
adb reboot bootloader
fastboot oem unlock
fastboot getvar all

# install recovery system - http://www.clockworkmod.com/rommanager
fastboot flash recovery /home/tait/Downloads/recovery-clockwork-touch-6.0.4.7-grouper.img

# enter wcm recovery mode -> install zip -> sideload
adb sideload superuser.zip

# systemd-journald
journalctl --dmesg -f
journalctl --full -f

# burn iso with cdkit
readcd -v dev=/dev/cdrom -f abc.iso
# burn dvd - dvd+rw-tools
growisofs -dvd-compat -Z /dev/sr0=/home/tait/Dropbox/os/window/xp_pro_sp2.iso

# xdg
xdg-mime default feh.desktop image/jpeg
xdg-mime default mupdf.desktop application/pdf
xdg-mime default vim.desktop text/plain
xdg-mime default vim.desktop application/octet-stream
xdg-mime default vim.desktop text/x-c

xdg-mime query default image/jpeg
xdg-mime query default application/pdf
xdg-mime query default text/plain


