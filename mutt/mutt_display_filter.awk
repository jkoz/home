#/usr/bin/awk -f

# 's/^Date:\\s*(([F-Wa-u]{3},\\s*)?[[:digit:]]{1,2}\\s+[A-Sa-y]{3}\\s+[[:digit:]]{4}\\s+[[:digit:]]{1,2}:[[:digit:]]{1,2}(:[[:digit:]]{1,2})?\\s+[+-][[:digit:]]{4})/date +'Date: %a, %d %b %Y %H:%M:%S %z' -d '\\1'/e \
# '/\\[-- Type: text.* --\\]/d' \
# '/\\[-- Attachment #[0-9] --\\]/d' \
# '/\\[-- Autoview.* --\\]/d' \
# '/\\[-- Type.* --\\]/d' \
# '/\\[-- .*unsupported.* --\\]/d' \
# '/\\[-- Attachment #[0-9] --\\]/d' \
# 's/Attachment #[0-9]: //g' \
# '/^(From:.*)/i────────────────────────────────────────' \
# '/./,/^$/!d'"

# {print};

BEGIN {
    t = 0;
};

/^From:/ {
    t++;
    if (t > 1) print "─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────"
};

!/-----Original Message-----/ && \
!/\[-- Type: text.* --\]/  && \
!/\[-- Attachment #[0-9] --\]/ && \
!/\[-- Autoview.* --\]/ && \
!/\[-- Type.* --\]/ && \
!/\[-- .*unsupported.* --\]/ && \
!/\[-- Attachment #[0-9] --\]/ {
    gsub("Attachment #[0-9]:","",$0);

    /^\s*$/ ? b++ : b=0;  # if current line is non blank, reset to 0
    if (b <=1 ) print;
};

